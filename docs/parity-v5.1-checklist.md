# Lightweight Charts v5.1 Parity Checklist

Use this document to track parity progress.

## Status Legend

- `not started`
- `in progress`
- `done`
- `blocked`

## Core

| ID | Area | Feature | Status | Acceptance Criteria | Test Evidence | Notes |
|---|---|---|---|---|---|---|
| C-001 | Time Scale | Logical-to-pixel mapping | done | Matches v5.1 behavior for visible range and spacing | `tests/core_scale_tests.rs`, `tests/property_scale_tests.rs`, `tests/api_tuning_tests.rs` | Full/visible range controls and fit-to-data tuning are implemented. |
| C-002 | Price Scale | Autoscale baseline | done | Stable autoscale with sparse/volatile data | `tests/core_scale_tests.rs`, `tests/property_scale_tests.rs`, `tests/api_tuning_tests.rs`, `tests/api_smoke_tests.rs` | Tuned autoscale for points/candles with padding controls is implemented. |
| C-003 | Series | Candlestick rendering basics | done | OHLC bars render with deterministic geometry | `tests/candlestick_tests.rs`, `tests/candlestick_visible_tests.rs`, `tests/property_candlestick_tests.rs` | OHLC validation, deterministic projection, and visible-range candle projection are implemented. |
| C-004 | Interaction | Crosshair baseline | done | Pointer movement updates crosshair and labels deterministically | `tests/crosshair_tests.rs`, `tests/property_api_tests.rs` | Crosshair now exposes deterministic snapped pixel + logical labels (time/price) for points/candles. |
| C-005 | Interaction | Visible range pan/zoom baseline | done | Drag and zoom operations move visible range deterministically around anchor points | `tests/interaction_pan_zoom_tests.rs`, `tests/property_api_tests.rs` | Time scale pan/zoom APIs are implemented for both logical-time and pixel anchors. |
| C-012 | Interaction | Crosshair normal/magnet mode | done | Crosshair supports deterministic snap-on (`Magnet`) and snap-off (`Normal`) behavior | `tests/crosshair_tests.rs`, `tests/property_api_tests.rs` | Crosshair mode API is implemented and pointer behavior switches deterministically between raw pointer tracking and nearest-sample snapping. |
| C-013 | Interaction | Wheel zoom controller baseline | done | Wheel deltas map to deterministic zoom factors around pixel anchors | `tests/interaction_wheel_zoom_tests.rs`, `tests/property_api_tests.rs` | Wheel zoom API is implemented with explicit notch normalization, input validation, and anchor-stable zoom behavior. |
| C-014 | Interaction | Wheel pan + kinetic pan controller | done | Wheel pan and inertial pan steps update visible range deterministically while preserving span | `tests/interaction_kinetic_pan_tests.rs`, `tests/property_api_tests.rs` | Wheel pan and kinetic pan APIs are implemented with explicit step normalization, tunable decay, and deterministic step-based integration. |
| C-015 | Interaction | Time-scale fixed-edge constraints (`fixLeftEdge`/`fixRightEdge`) | done | Time navigation supports deterministic left/right edge constraints that clamp pan/zoom/set-range behavior against fitted full-range bounds | `tests/time_scale_edge_behavior_tests.rs`, `tests/interaction_pan_zoom_tests.rs` | Added `TimeScaleEdgeBehavior` API (`fix_left_edge`, `fix_right_edge`) and edge-clamp enforcement across range mutation flows (`set_time_visible_range`, pan, zoom, wheel, and fit). |
| C-016 | Interaction | Scroll/scale enable flags parity (`handleScroll`/`handleScale`) | done | Hosts can deterministically enable/disable wheel/drag pan and wheel/pinch zoom paths without side effects in other interaction flows | `tests/interaction_input_behavior_tests.rs`, `tests/interaction_pan_zoom_tests.rs`, `tests/interaction_wheel_zoom_tests.rs` | Added `InteractionInputBehavior` API (`handle_scroll`, `handle_scale`) plus gated input paths (`pan_start/end`, `pan_time_visible_by_pixels`, `wheel_pan_time_visible`, `wheel_zoom_time_visible`, `pinch_zoom_time_visible`) with explicit no-op semantics when disabled. |
| C-017 | Time Scale | Right-offset and logical bar spacing controls | done | Time scale can preserve deterministic right margin and spacing semantics under pan/zoom similar to Lightweight Charts navigation feel | `tests/time_scale_navigation_behavior_tests.rs`, `tests/time_scale_edge_behavior_tests.rs` | Added `TimeScaleNavigationBehavior` (`right_offset_bars`, `bar_spacing_px`) with deterministic range synthesis from data step estimation and viewport width, composed with fixed-edge constraints. |
| C-018 | Time Scale | Visible-range lock on viewport resize | done | Viewport width changes keep deterministic visible-range anchoring policy (including optional right-edge lock) without jump artifacts | `tests/time_scale_resize_behavior_tests.rs`, `tests/time_scale_navigation_behavior_tests.rs` | Added `TimeScaleResizeBehavior` (`lock_visible_range_on_resize`, `anchor`) with deterministic `Left`/`Center`/`Right` anchoring in `set_viewport`, composed with navigation spacing and edge constraints. |
| C-019 | Time Scale | Continuous time-range shift on realtime append | done | Realtime data append can preserve right-edge tracking semantics without forcing full refit and without discontinuities under active offset/spacing policies | `tests/time_scale_realtime_append_behavior_tests.rs`, `tests/time_scale_navigation_behavior_tests.rs` | Added `TimeScaleRealtimeAppendBehavior` (`preserve_right_edge_on_append`, `right_edge_tolerance_bars`) and append-time range updates in `append_point`/`append_candle`, composed with navigation/edge constraints. |
| C-020 | Data | Realtime update append/replace semantics | done | Incremental update API must append when incoming time is newer, replace when incoming time matches latest sample, and reject out-of-order (older) updates deterministically | `tests/realtime_update_semantics_tests.rs`, `tests/time_scale_realtime_append_behavior_tests.rs` | Added `update_point`/`update_candle` API methods with non-decreasing time validation and composition with realtime append follow-tail policy. |
| C-021 | Time Scale | Scroll-to-realtime command parity (`scrollToRealTime`) | done | Host can deterministically reattach visible range to realtime edge, preserving span in free-navigation mode and respecting active navigation/edge constraints | `tests/time_scale_scroll_to_realtime_tests.rs`, `tests/time_scale_navigation_behavior_tests.rs` | Added `scroll_time_to_realtime` API with deterministic behavior for free mode, right-offset/spacing mode, and fixed-edge composition. |
| C-022 | Time Scale | Scroll position introspection and direct positioning (`scrollPosition`/`scrollToPosition`) | done | Host can read deterministic bar-based scroll position and set explicit bar-based right-edge offset while preserving span and honoring edge constraints | `tests/time_scale_scroll_position_tests.rs`, `tests/time_scale_scroll_to_realtime_tests.rs` | Added `time_scroll_position_bars` and `scroll_time_to_position_bars` with deterministic reference-step resolution and explicit invalid-input handling. |
| C-023 | Time Scale | Pixel-based right margin priority (`rightOffsetPixels`) | done | Host can configure deterministic pixel right margin with higher precedence than bar-based right offset, composed with spacing and edge constraints | `tests/time_scale_right_offset_pixels_tests.rs`, `tests/time_scale_scroll_to_realtime_tests.rs` | Added `time_scale_right_offset_px` / `set_time_scale_right_offset_px` with priority semantics over `right_offset_bars` in navigation synthesis. |
| C-024 | Time Scale | Scroll-zoom right-edge anchoring (`rightBarStaysOnScroll`) | done | Host can keep right edge anchored during wheel/pinch zoom when configured, while default behavior remains pointer-anchor zoom | `tests/time_scale_scroll_zoom_behavior_tests.rs`, `tests/interaction_wheel_zoom_tests.rs` | Added `TimeScaleScrollZoomBehavior` (`right_bar_stays_on_scroll`) and integrated anchoring policy into wheel/pinch zoom paths. |
| C-025 | Interaction | Granular scroll/scale input gates parity (`handleScroll`/`handleScale` detailed options) | done | Host can independently enable/disable drag-pan, wheel-pan, wheel-zoom, pinch-zoom, and axis-scale option gates while preserving deterministic no-op semantics for disabled active paths | `tests/interaction_input_behavior_tests.rs`, `tests/chart_config_interaction_behavior_tests.rs`, `tests/interaction_axis_scale_behavior_tests.rs` | Extended `InteractionInputBehavior` with per-input knobs (`scroll_mouse_wheel`, `scroll_pressed_mouse_move`, `scroll_horz_touch_drag`, `scroll_vert_touch_drag`, `scale_mouse_wheel`, `scale_pinch`, `scale_axis_pressed_mouse_move`, `scale_axis_double_click_reset`) and wired active paths (`pan_start/end`, drag pan, wheel pan, wheel zoom, pinch zoom, price-axis drag-scale, axis double-click reset). |
| C-026 | Time Scale | Zoom-spacing limits parity (`minBarSpacing` baseline) | done | Host can enforce deterministic bar-spacing bounds so zoom-out/zoom-in cannot cross configured pixel spacing limits, composed with navigation and edge constraints | `tests/time_scale_zoom_limit_behavior_tests.rs`, `tests/time_scale_navigation_behavior_tests.rs` | Added `TimeScaleZoomLimitBehavior` (`min_bar_spacing_px`, optional `max_bar_spacing_px`) plus constraint integration across range mutation flows and viewport updates. |
| C-027 | Interaction | Crosshair startup mode config parity (`crosshair.mode`) | done | Host can deterministically choose startup crosshair mode through bootstrap config without requiring a post-init setter call | `tests/crosshair_config_behavior_tests.rs`, `tests/crosshair_tests.rs` | Extended `ChartEngineConfig` with `crosshair_mode` + builder `with_crosshair_mode`; engine bootstrap applies configured mode at initialization. |
| C-028 | Price Scale | Realtime autoscale policy on incremental updates | done | Host can opt into deterministic autoscale refresh after append/update flows to keep live price range synchronized without explicit autoscale calls | `tests/price_scale_realtime_behavior_tests.rs` | Added `PriceScaleRealtimeBehavior` (`autoscale_on_data_update`) with best-effort autoscale integration on `append_*`/`update_*` flows, prioritizing candle envelope when candle data exists. |
| C-029 | Interaction | Touch-drag scroll path parity (`horzTouchDrag`/`vertTouchDrag`) | done | Host can deterministically pan time range through touch-style drag input with independent horizontal/vertical gates and no-op semantics when disabled | `tests/interaction_touch_pan_tests.rs`, `tests/interaction_input_behavior_tests.rs` | Added `touch_drag_pan_time_visible(delta_x_px, delta_y_px)` and wired `InteractionInputBehavior` touch gates (`scroll_horz_touch_drag`, `scroll_vert_touch_drag`) with dominant-axis resolution. |
| C-030 | Price Scale | Inverted scale direction parity (`invertScale`) | done | Host can deterministically invert price-axis mapping direction while preserving round-trip conversion and mode/autoscale behavior | `tests/price_scale_invert_behavior_tests.rs`, `tests/price_scale_mode_tests.rs` | Added `set_price_scale_inverted`/`price_scale_inverted` API and core `PriceScale` inverted mapping support preserved across mode switches and autoscale rebuilds. |
| C-031 | Price Scale | Scale margins parity (`scaleMargins`) | done | Host can configure deterministic top/bottom price-scale whitespace margins with validation and preserved behavior across autoscale/mode transitions | `tests/price_scale_margin_behavior_tests.rs`, `tests/price_scale_invert_behavior_tests.rs` | Added `PriceScaleMarginBehavior` and API methods `price_scale_margin_behavior` / `set_price_scale_margin_behavior`, backed by core margin-aware price mapping. |
| C-032 | Interaction | Crosshair hidden mode parity (`CrosshairMode.Hidden`) | done | Host can force crosshair to remain hidden regardless of pointer movement while preserving deterministic mode switching semantics | `tests/crosshair_tests.rs`, `tests/crosshair_config_behavior_tests.rs` | Added `CrosshairMode::Hidden` and interaction-controller handling that keeps crosshair state hidden on pointer moves and when switching mode. |
| C-033 | Price Scale | Autoscale-on-set policy for full data replacement | done | Host can opt into deterministic price autoscale refresh on `set_data`/`set_candles`, independent from append/update autoscale policy | `tests/price_scale_realtime_behavior_tests.rs` | Extended `PriceScaleRealtimeBehavior` with `autoscale_on_data_set` and wired best-effort autoscale integration into full-replacement data paths. |
| C-034 | API | Bootstrap parity for initial price-scale options | done | Host can deterministically bootstrap price-scale mode, inversion, and margins from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_price_scale_behavior_tests.rs` | Extended `ChartEngineConfig` with `price_scale_mode`, `price_scale_inverted`, and `price_scale_margins` plus builder helpers; engine init now applies bootstrap options with validation. |
| C-035 | API | Bootstrap parity for interaction input options | done | Host can deterministically bootstrap interaction input gates from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_interaction_behavior_tests.rs`, `tests/interaction_input_behavior_tests.rs` | Extended `ChartEngineConfig` with `interaction_input_behavior` and `with_interaction_input_behavior`; engine init now applies initial interaction gate policy directly. |
| C-036 | API | Bootstrap parity for time-scale navigation options | done | Host can deterministically bootstrap initial time-scale navigation offset behavior from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_time_scale_behavior_tests.rs`, `tests/time_scale_right_offset_pixels_tests.rs` | Extended `ChartEngineConfig` with `time_scale_navigation_behavior` and `time_scale_right_offset_px` plus builder helpers; engine init applies validated navigation bootstrap options. |
| C-037 | API | Bootstrap parity for price-scale realtime autoscale policy | done | Host can deterministically bootstrap realtime autoscale policy from `ChartEngineConfig` for both set and append/update flows | `tests/chart_config_price_scale_realtime_behavior_tests.rs`, `tests/price_scale_realtime_behavior_tests.rs` | Extended `ChartEngineConfig` with `price_scale_realtime_behavior` and `with_price_scale_realtime_behavior`; engine init now applies policy without post-init setter calls. |
| C-038 | API | Bootstrap parity for time-scale zoom policies | done | Host can deterministically bootstrap scroll-zoom anchoring and zoom-limit policies from `ChartEngineConfig` without post-init setter calls | `tests/chart_config_time_scale_zoom_behavior_tests.rs`, `tests/time_scale_scroll_zoom_behavior_tests.rs`, `tests/time_scale_zoom_limit_behavior_tests.rs` | Extended `ChartEngineConfig` with `time_scale_scroll_zoom_behavior` and `time_scale_zoom_limit_behavior` plus builder helpers; engine init applies validated zoom policy bootstrap options. |
| C-039 | API | Bootstrap parity for time-scale edge/resize/realtime policies | done | Host can deterministically bootstrap edge constraints, resize policy, and realtime-append policy from `ChartEngineConfig` without post-init setter calls | `tests/chart_config_time_scale_policy_behavior_tests.rs`, `tests/time_scale_resize_behavior_tests.rs`, `tests/time_scale_realtime_append_behavior_tests.rs` | Extended `ChartEngineConfig` with `time_scale_edge_behavior`, `time_scale_resize_behavior`, and `time_scale_realtime_append_behavior` plus builder helpers; engine init applies validated policy bootstrap options. |
| C-040 | API | Bootstrap parity for axis-label formatter policies | done | Host can deterministically bootstrap time/price axis label policies from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_axis_label_behavior_tests.rs`, `tests/time_axis_formatter_tests.rs`, `tests/price_axis_formatter_tests.rs` | Extended `ChartEngineConfig` with `time_axis_label_config` and `price_axis_label_config` plus builder helpers; engine init now applies validated axis-label bootstrap options. |
| C-041 | API | Bootstrap parity for last-price source mode policy | done | Host can deterministically bootstrap last-price source selection mode from `ChartEngineConfig` without requiring a post-init style mutation | `tests/chart_config_last_price_source_mode_tests.rs`, `tests/render_frame_tests.rs` | Extended `ChartEngineConfig` with `last_price_source_mode` and `with_last_price_source_mode`; engine init now applies startup `RenderStyle.last_price_source_mode` policy. |
| C-042 | Data | Canonical full-replacement data ordering and dedup semantics | done | Full replacement APIs (`set_data`/`set_candles`) deterministically canonicalize input by filtering invalid samples, sorting by time, and keeping the latest sample per duplicate timestamp | `tests/data_set_canonicalization_tests.rs` | Added deterministic canonicalization pipeline for full replacement data paths with finite/OHLC invariant filtering and duplicate-time replacement semantics. |
| C-043 | API | Last-price behavior controller parity (`priceLineVisible`/`lastValueVisible`/`priceLineSource`) | done | Host can deterministically control last-price line visibility, label visibility, trend-color mode, and source mode through dedicated API methods instead of full style mutation | `tests/last_price_behavior_api_tests.rs`, `tests/render_frame_tests.rs` | Added `LastPriceBehavior` contract and API methods `last_price_behavior` / `set_last_price_behavior` mapped to render-style last-price fields. |
| C-044 | API | Bootstrap parity for last-price behavior policy | done | Host can deterministically bootstrap full last-price behavior policy from `ChartEngineConfig` (line/label visibility, trend-color mode, source mode) without requiring post-init setter calls | `tests/chart_config_last_price_behavior_tests.rs`, `tests/last_price_behavior_api_tests.rs` | Extended `ChartEngineConfig` with optional `last_price_behavior` and builder `with_last_price_behavior`; engine init applies policy with explicit precedence over legacy `last_price_source_mode`. |
| C-045 | Data | Property robustness parity for full-replacement canonicalization | done | Property tests verify deterministic canonicalization invariants for `set_data`/`set_candles` across sparse/extreme/invalid input (sorted unique output, invalid filtering, duplicate replacement semantics) | `tests/property_data_set_canonicalization_tests.rs`, `tests/data_set_canonicalization_tests.rs` | Added dedicated `proptest` coverage for full-replacement canonicalization contracts of points and candles. |
| C-046 | API | Crosshair guide-line visibility controller parity | done | Host can deterministically control shared/per-axis crosshair guide-line visibility through dedicated API methods without mutating full render style | `tests/crosshair_guide_line_behavior_api_tests.rs`, `tests/render_frame_tests.rs` | Added `CrosshairGuideLineBehavior` contract and API methods `crosshair_guide_line_behavior` / `set_crosshair_guide_line_behavior`, mapped to `show_crosshair_lines` + per-axis toggles. |
| C-047 | API | Bootstrap parity for crosshair guide-line visibility policy | done | Host can deterministically bootstrap crosshair guide-line shared/per-axis visibility from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_crosshair_guide_line_behavior_tests.rs`, `tests/crosshair_guide_line_behavior_api_tests.rs` | Extended `ChartEngineConfig` with `crosshair_guide_line_behavior` and builder `with_crosshair_guide_line_behavior`; engine init now applies configured policy. |
| C-048 | API | Crosshair guide-line stroke-style controller parity | done | Host can deterministically control crosshair guide-line shared/per-axis color, width, and stroke style through dedicated API methods without mutating full render style | `tests/crosshair_guide_line_style_behavior_api_tests.rs`, `tests/render_frame_tests.rs` | Added `CrosshairGuideLineStyleBehavior` contract and API methods `crosshair_guide_line_style_behavior` / `set_crosshair_guide_line_style_behavior`, mapped to shared/per-axis guide-line style fields. |
| C-049 | API | Bootstrap parity for crosshair guide-line stroke-style policy | done | Host can deterministically bootstrap crosshair guide-line shared/per-axis stroke-style policy from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_crosshair_guide_line_style_behavior_tests.rs`, `tests/crosshair_guide_line_style_behavior_api_tests.rs` | Extended `ChartEngineConfig` with optional `crosshair_guide_line_style_behavior` and builder `with_crosshair_guide_line_style_behavior`; engine init now applies configured style policy. |
| C-050 | API | Crosshair axis-label visibility controller parity | done | Host can deterministically control crosshair time/price label visibility plus label-box and box-border visibility through dedicated API methods without mutating full render style | `tests/crosshair_axis_label_visibility_behavior_api_tests.rs`, `tests/render_frame_tests.rs` | Added `CrosshairAxisLabelVisibilityBehavior` contract and API methods `crosshair_axis_label_visibility_behavior` / `set_crosshair_axis_label_visibility_behavior` mapped to crosshair axis-label visibility toggles. |
| C-051 | API | Bootstrap parity for crosshair axis-label visibility policy | done | Host can deterministically bootstrap crosshair axis-label visibility toggles from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_crosshair_axis_label_visibility_behavior_tests.rs`, `tests/crosshair_axis_label_visibility_behavior_api_tests.rs` | Extended `ChartEngineConfig` with `crosshair_axis_label_visibility_behavior` and builder `with_crosshair_axis_label_visibility_behavior`; engine init now applies configured visibility policy. |
| C-052 | API | Crosshair axis-label style controller parity | done | Host can deterministically control crosshair time/price label color, font size, axis-offset, and axis-inset behavior through dedicated API methods without mutating full render style | `tests/crosshair_axis_label_style_behavior_api_tests.rs`, `tests/render_frame_tests.rs` | Added `CrosshairAxisLabelStyleBehavior` contract and API methods `crosshair_axis_label_style_behavior` / `set_crosshair_axis_label_style_behavior` mapped to core crosshair axis-label style fields. |
| C-053 | API | Bootstrap parity for crosshair axis-label style policy | done | Host can deterministically bootstrap crosshair axis-label style policy from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_crosshair_axis_label_style_behavior_tests.rs`, `tests/crosshair_axis_label_style_behavior_api_tests.rs` | Extended `ChartEngineConfig` with optional `crosshair_axis_label_style_behavior` and builder `with_crosshair_axis_label_style_behavior`; engine init now applies configured style policy. |
| C-054 | API | Crosshair axis-label box style controller parity | done | Host can deterministically control crosshair time/price label-box fill, border, and corner-radius policies (shared and per-axis) through dedicated API methods without mutating full render style | `tests/crosshair_axis_label_box_style_behavior_api_tests.rs`, `tests/render_frame_tests.rs` | Added `CrosshairAxisLabelBoxStyleBehavior` contract and API methods `crosshair_axis_label_box_style_behavior` / `set_crosshair_axis_label_box_style_behavior` mapped to crosshair label-box style fields. |
| C-055 | API | Bootstrap parity for crosshair axis-label box style policy | done | Host can deterministically bootstrap crosshair axis-label box style policy from `ChartEngineConfig` without requiring post-init setter calls | `tests/chart_config_crosshair_axis_label_box_style_behavior_tests.rs`, `tests/crosshair_axis_label_box_style_behavior_api_tests.rs` | Extended `ChartEngineConfig` with optional `crosshair_axis_label_box_style_behavior` and builder `with_crosshair_axis_label_box_style_behavior`; engine init now applies configured box-style policy. |
| C-056 | Defaults | Lightweight v5.1 baseline defaults alignment | done | Engine defaults align with v5.1 on core knobs available in the Rust API (`priceScale.scaleMargins` baseline, crosshair stroke baseline, and axis tick visibility baseline) | `tests/chart_config_price_scale_behavior_tests.rs`, `tests/price_scale_margin_behavior_tests.rs`, `tests/render_style_tests.rs` | Updated default `priceScale` margins (`top=0.2`, `bottom=0.1`), crosshair stroke baseline to large-dashed family, and default axis tick-mark visibility to `false` to reduce first-render visual divergence versus v5.1. |
| C-057 | Layout | Section-boundary non-overlap policy | done | Rendered labels/boxes are vertically clamped to owning sections (plot/time-axis/price-axis) to prevent panel overlap under edge-pointer and overflow scenarios | `tests/render_axis_layout_tests.rs`, `tests/render_frame_tests.rs` | Hardened price-axis label, last-price label-box, and crosshair axis-label box vertical layout clipping so time-axis and plot-panel primitives remain section-safe. |
| C-006 | Series | Line series projection baseline | done | Line data maps to deterministic segment geometry over active scales | `tests/line_series_tests.rs`, `tests/property_line_series_tests.rs` | Core and API line-segment projection helpers are implemented. |
| C-007 | Series | Visible data window selection | done | Point/candle series can be filtered by visible logical range with deterministic ordering | `tests/visible_data_window_tests.rs`, `tests/property_api_tests.rs` | Core windowing helpers and API visible-window methods (with overscan) are implemented. |
| C-008 | Series | Area series projection baseline | done | Area data maps to deterministic line/fill geometry over active scales | `tests/area_series_tests.rs`, `tests/property_area_series_tests.rs` | Core and API area geometry projection (visible + overscan variants) are implemented with explicit baseline-closed polygons. |
| C-009 | Series | Baseline series projection baseline | done | Baseline data maps to deterministic line + above/below fill geometry over active scales | `tests/baseline_series_tests.rs`, `tests/property_baseline_series_tests.rs` | Core and API baseline geometry projection (visible + overscan variants) are implemented with explicit baseline-closed polygons and clamped split regions. |
| C-010 | Series | Histogram series projection baseline | done | Histogram values map to deterministic bar geometry anchored to a baseline | `tests/histogram_series_tests.rs`, `tests/property_histogram_series_tests.rs` | Core and API histogram projection (visible + overscan variants) are implemented with explicit bar width validation and baseline anchoring. |
| C-011 | Series | OHLC bar series projection baseline | done | OHLC bars map to deterministic stem/tick geometry over active scales | `tests/bar_series_tests.rs`, `tests/property_bar_series_tests.rs` | Core and API bar projection (visible + overscan variants) are implemented with explicit tick width validation and OHLC ordering invariants. |

## Render

| ID | Area | Feature | Status | Acceptance Criteria | Test Evidence | Notes |
|---|---|---|---|---|---|---|
| R-001 | Pipeline | Render frame + Cairo/Pango backend baseline | done | Engine builds deterministic render commands and Cairo backend draws series + axis labels | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `tests/render_cairo_backend_tests.rs`, `benches/core_math_bench.rs` | `RenderFrame` now carries explicit line/text primitives, with deterministic axis tick labels and GTK draw-context support. |
| R-002 | Price Axis | Tick density + collision strategy | done | Price/time labels keep deterministic spacing and avoid overlap in narrow viewports | `tests/render_axis_layout_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Axis labels now use deterministic density selection and spacing-based collision filtering for narrow and wide layouts. |
| R-003 | Time Axis | Time formatter and locale policy | done | Time labels support deterministic built-in policies, locale presets, and injectable custom formatter logic | `tests/time_axis_formatter_tests.rs`, `tests/property_render_frame_tests.rs` | Added decimal + UTC datetime policies, `en-US/es-ES` locale presets, and runtime custom formatter injection. |
| R-004 | Price Scale | Visual parity styling baseline | done | Render output includes deterministic grid/axis styling close to Lightweight Charts conventions | `tests/render_style_tests.rs`, `tests/render_cairo_backend_tests.rs`, `benches/core_math_bench.rs` | Added configurable render style contract (grid, axis borders, label colors, scale panel sizing) and plot/axis panel split in frame generation. |
| R-005 | Time Axis | Zoom-aware formatter + label cache | done | Time labels adapt formatting by visible-span zoom level and repeated redraws reuse cached formatted labels deterministically | `tests/time_axis_formatter_tests.rs`, `benches/core_math_bench.rs` | Added `UtcAdaptive` formatter policy and in-engine time-label cache with hit/miss stats for redraw optimization. |
| R-006 | Time Axis | Session boundary/timezone-aware labeling | done | Time labels support trading-session boundaries and configurable timezone alignment | `tests/time_axis_formatter_tests.rs`, `benches/core_math_bench.rs` | Added fixed-offset timezone alignment and optional session envelope that keeps boundary labels explicit while collapsing in-session intraday labels to time-only format. |
| R-007 | Time Axis | Major tick visual emphasis | done | Session/day boundary ticks render with deterministic major grid/label styling | `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added major tick classification (session boundary + local midnight) with configurable major grid color/width and label font size. |
| R-008 | Price Axis | Formatter precision/min-move policy | done | Price labels support fixed/adaptive precision, min-move rounding, and custom formatter injection | `tests/price_axis_formatter_tests.rs`, `benches/core_math_bench.rs` | Added `PriceAxisLabelPolicy` (`FixedDecimals`/`Adaptive`/`MinMove`) with deterministic min-move snapping and locale-aware formatting. |
| R-009 | Price Axis | Display mode parity (normal/percent/indexed) | done | Price labels support deterministic normal/percentage/indexed-to-100 modes with configurable/derived base values | `tests/price_axis_formatter_tests.rs`, `benches/core_math_bench.rs` | Added `PriceAxisDisplayMode` with percent suffix behavior and explicit/derived base-price transforms. |
| R-010 | Price Scale | Linear/log mode baseline | done | Price scale supports deterministic linear/log mapping, mode switching, and log-safe autoscale behavior | `tests/core_scale_tests.rs`, `tests/price_scale_mode_tests.rs`, `benches/core_math_bench.rs` | Added `PriceScaleMode` (`Linear`/`Log`), API mode switching, and log-domain tick/autoscale handling. |
| R-011 | Price Axis | Log tick ladder parity (1/2/5 decades) | done | Log-mode ticks/labels prefer deterministic 1/2/5 * 10^n levels and preserve domain direction | `tests/core_scale_tests.rs`, `tests/price_axis_formatter_tests.rs`, `benches/core_math_bench.rs` | Added log ladder tick generation with deterministic downsampling and endpoint preservation. |
| R-012 | Price Axis | Label cache baseline | done | Repeated redraws reuse deterministic cached price-axis labels across built-in/custom formatter paths | `tests/price_axis_formatter_tests.rs`, `benches/core_math_bench.rs` | Added cache stats/clear APIs and deterministic cache-key profiles for built-in/custom formatters. |
| R-013 | Price Axis | Last price line + label baseline | done | Render frame includes deterministic latest-price marker line/label with configurable style toggles | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added latest-price marker rendering using newest point/candle sample, with style knobs for line/label colors, widths, and visibility. |
| R-014 | Price Axis | Last-price label collision filter | done | Price-axis labels avoid overlap with last-price label via deterministic exclusion radius and fallback label retention | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added configurable `last_price_label_exclusion_px` filter for axis labels near the last-price marker. |
| R-015 | Price Axis | Last-price trend color policy | done | Last-price marker can switch to deterministic up/down/neutral coloring based on latest vs previous visible sample | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style trend-color knobs and optional trend-driven color selection for last-price line/label. |
| R-016 | Price Axis | Last-price source mode policy | done | Last-price marker can deterministically target newest full-series sample or newest visible-range sample under pan/zoom | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added `LastPriceSourceMode` (`LatestData`/`LatestVisible`) and style-level source selection for last-price marker resolution. |
| R-017 | Price Axis | Last-price label box visual parity | done | Last-price axis label can render a deterministic filled price-box with configurable color/padding and text contrast | `tests/render_frame_tests.rs`, `tests/render_cairo_backend_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added `RectPrimitive` render support and optional style-driven last-price label box rendering in axis panel. |
| R-018 | Price Axis | Label-box border/radius + auto-contrast policy | done | Last-price label box supports deterministic border and corner radius plus automatic text contrast for bright/dark fills | `tests/render_frame_tests.rs`, `tests/render_cairo_backend_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added styled `RectPrimitive` border/radius fields, rounded-box Cairo path rendering, and optional automatic box-text contrast policy. |
| R-019 | Price Axis | Label-box fit-text width + horizontal padding policy | done | Last-price label box can use deterministic full-axis or fit-text width mode with configurable horizontal padding and minimum width | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added `LastPriceLabelBoxWidthMode` (`FullAxis`/`FitText`) with deterministic text-width estimation and width clamping to axis panel. |
| R-020 | Price Axis | Axis label inset + tick-mark length policy | done | Price-axis labels and tick marks use deterministic, configurable horizontal inset and extension length | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs for right inset and tick-mark length, applied to both regular price labels and last-price label anchor path. |
| R-021 | Price Axis | Dedicated tick-mark color/width style policy | done | Price-axis tick marks can be styled independently from axis border color/width while keeping deterministic geometry | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `price_axis_tick_mark_color` and `price_axis_tick_mark_width` for short horizontal price-axis marks. |
| R-022 | Price Axis | Axis label typography + vertical offset policy | done | Price-axis labels support deterministic configurable font size and vertical offset from tick Y | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `price_axis_label_font_size_px` and `price_axis_label_offset_y_px` replacing fixed axis-label constants. |
| R-023 | Price Axis | Last-price label vertical offset policy | done | Last-price axis label uses deterministic configurable vertical offset from marker Y | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `last_price_label_offset_y_px` replacing fixed formula coupling to font size. |
| R-024 | Price Axis | Last-price label right inset policy | done | Last-price label can use deterministic right inset independent from regular axis-label inset when box mode is disabled | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `last_price_label_padding_right_px` and independent anchor resolution for non-box last-price labels. |
| R-025 | Price Axis | Tick-mark visibility policy | done | Price-axis short tick marks can be deterministically enabled/disabled without affecting label/grid generation | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_price_axis_tick_marks` for visibility control of horizontal price-axis marks. |
| R-026 | Price Axis | Horizontal grid-line visibility policy | done | Price-axis horizontal grid lines can be deterministically enabled/disabled while labels/tick-marks remain independent | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_price_axis_grid_lines` for horizontal price-axis grid visibility control. |
| R-027 | Price Axis | Regular label visibility policy | done | Price-axis regular labels can be deterministically enabled/disabled while last-price label remains independently configurable | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_price_axis_labels` for visibility control of non-marker price-axis labels. |
| R-028 | Price Axis | Dedicated horizontal grid-line style policy | done | Price-axis horizontal grid lines support dedicated deterministic color/width styling independent from time-grid lines | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `price_axis_grid_line_color` and `price_axis_grid_line_width` for axis-specific horizontal grid styling. |
| R-029 | Time Axis | Regular label typography + offset + tick-length policy | done | Time-axis regular labels and short axis tick marks use deterministic configurable font size, vertical anchor offset, and tick length | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `time_axis_label_font_size_px`, `time_axis_label_offset_y_px`, and `time_axis_tick_mark_length_px` replacing fixed time-axis constants. |
| R-030 | Time Axis | Regular label visibility policy | done | Time-axis regular labels can be deterministically enabled/disabled while grid lines and tick marks remain independent | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_time_axis_labels` for visibility control of regular time-axis labels. |
| R-031 | Time Axis | Tick-mark visibility policy | done | Time-axis short tick marks can be deterministically enabled/disabled while grid lines and labels remain independent | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_time_axis_tick_marks` for visibility control of short time-axis tick marks. |
| R-032 | Time Axis | Dedicated tick-mark style policy | done | Time-axis short tick marks support deterministic dedicated color/width styling independent from axis-border style | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `time_axis_tick_mark_color` and `time_axis_tick_mark_width` for short time-axis tick styling. |
| R-033 | Time Axis | Dedicated label color policy | done | Time-axis labels support deterministic dedicated color styling independent from price-axis label color | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `time_axis_label_color` for time-axis label color control. |
| R-034 | Time Axis | Major-label visibility policy | done | Major time-axis labels can be deterministically enabled/disabled without affecting regular time labels | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_major_time_labels` for visibility control of major time-axis labels. |
| R-035 | Time Axis | Major-grid visibility policy | done | Major time-axis grid lines can be deterministically enabled/disabled without affecting regular time grid lines | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_major_time_grid_lines` for visibility control of major time-axis grid lines. |
| R-036 | Time Axis | Dedicated major-label color policy | done | Major time-axis labels support deterministic dedicated color styling independent from regular time-axis label color | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `major_time_label_color` for major time-axis label color control. |
| R-037 | Time Axis | Dedicated major tick-mark style policy | done | Major time-axis tick marks support deterministic dedicated color/width styling independent from regular time-axis tick marks | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `major_time_tick_mark_color` and `major_time_tick_mark_width` for major time-axis tick-mark styling. |
| R-038 | Time Axis | Dedicated major tick-mark length policy | done | Major time-axis tick marks support deterministic dedicated length independent from regular time-axis tick-mark length | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `major_time_tick_mark_length_px` for major time-axis tick-mark length control. |
| R-039 | Time Axis | Major tick-mark visibility policy | done | Major time-axis tick marks can be deterministically enabled/disabled without affecting regular time-axis tick marks | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_major_time_tick_marks` for major time-axis tick-mark visibility control. |
| R-040 | Time Axis | Dedicated major-label vertical offset policy | done | Major time-axis labels support deterministic dedicated vertical offset independent from regular time-axis labels | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `major_time_label_offset_y_px` for major time-axis label Y-offset control. |
| R-041 | Axes | Time-axis border visibility policy | done | Bottom time-axis border can be deterministically enabled/disabled without affecting right price-axis border | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_time_axis_border` for bottom axis border visibility control. |
| R-042 | Axes | Price-axis border visibility policy | done | Right price-axis border can be deterministically enabled/disabled without affecting bottom time-axis border | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `show_price_axis_border` for right axis border visibility control. |
| R-043 | Crosshair | Crosshair guide-line render baseline | done | Crosshair renders deterministic horizontal/vertical guide lines in the plot pane, using snapped coordinates in magnet mode and style-level visibility toggles | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_line_color`, `crosshair_line_width`, `show_crosshair_horizontal_line`, and `show_crosshair_vertical_line`. |
| R-044 | Crosshair | Crosshair axis-label baseline | done | Crosshair renders deterministic time/price axis labels using snapped values in magnet mode and independent visibility toggles | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_color`, `crosshair_price_label_color`, `crosshair_axis_label_font_size_px`, `show_crosshair_time_label`, and `show_crosshair_price_label`. |
| R-045 | Crosshair | Crosshair axis-label box baseline | done | Crosshair time/price axis labels can render deterministic fit-text background boxes with configurable fill/padding and independent time/price visibility toggles | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_color`, `crosshair_label_box_padding_x_px`, `crosshair_label_box_padding_y_px`, `show_crosshair_time_label_box`, and `show_crosshair_price_label_box`. |
| R-046 | Crosshair | Crosshair axis-label box border/radius policy | done | Crosshair axis-label boxes support deterministic border width/color and corner-radius styling with safe radius clamping | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_border_width_px`, `crosshair_label_box_border_color`, and `crosshair_label_box_corner_radius_px`. |
| R-047 | Crosshair | Crosshair axis-label box auto-contrast text policy | done | Crosshair axis-label boxes support deterministic text color auto-contrast based on fill luminance with configurable manual override | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_text_color` and `crosshair_label_box_auto_text_contrast`. |
| R-048 | Crosshair | Crosshair axis-label box width-mode policy | done | Crosshair axis-label boxes support deterministic `FitText`/`FullAxis` width modes for both time and price axis panels | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knob `crosshair_label_box_width_mode` with `CrosshairLabelBoxWidthMode::{FitText, FullAxis}`. |
| R-049 | Crosshair | Crosshair axis-label box border visibility policy | done | Crosshair axis-label box borders can be deterministically enabled/disabled independently for time and price axis labels | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `show_crosshair_time_label_box_border` and `show_crosshair_price_label_box_border`. |
| R-050 | Crosshair | Crosshair axis-label vertical offset policy | done | Crosshair time and price axis labels support deterministic dedicated vertical offsets independent from regular axis-label offsets | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_offset_y_px` and `crosshair_price_label_offset_y_px`. |
| R-051 | Crosshair | Crosshair axis-label horizontal inset policy | done | Crosshair time and price axis labels support deterministic dedicated horizontal insets independent from regular axis-label insets | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_padding_x_px` and `crosshair_price_label_padding_right_px`. |
| R-052 | Crosshair | Crosshair axis-label font-size policy | done | Crosshair time and price axis labels support deterministic dedicated font-size controls independent from each other | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_font_size_px` and `crosshair_price_label_font_size_px`. |
| R-053 | Crosshair | Crosshair axis-label box padding policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent horizontal/vertical padding controls | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_box_padding_x_px`, `crosshair_time_label_box_padding_y_px`, `crosshair_price_label_box_padding_x_px`, and `crosshair_price_label_box_padding_y_px`. |
| R-054 | Crosshair | Crosshair axis-label box border style policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent border color/width controls | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_box_border_color`, `crosshair_time_label_box_border_width_px`, `crosshair_price_label_box_border_color`, and `crosshair_price_label_box_border_width_px`. |
| R-055 | Crosshair | Crosshair axis-label box corner-radius policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent corner-radius controls with safe clamping | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_box_corner_radius_px` and `crosshair_price_label_box_corner_radius_px`. |
| R-056 | Crosshair | Crosshair axis-label box width-mode policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent `FitText`/`FullAxis` width-mode controls with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_box_width_mode` and `crosshair_price_label_box_width_mode` (`Option<CrosshairLabelBoxWidthMode>` fallback to shared `crosshair_label_box_width_mode`). |
| R-057 | Crosshair | Crosshair axis-label box text policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent manual text color and auto-contrast policies with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_box_text_color`, `crosshair_price_label_box_text_color`, `crosshair_time_label_box_auto_text_contrast`, and `crosshair_price_label_box_auto_text_contrast`. |
| R-058 | Crosshair | Crosshair axis-label box fill-color policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent fill colors with shared fallback compatibility and per-axis auto-contrast input color | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_time_label_box_color` and `crosshair_price_label_box_color`. |
| R-059 | Crosshair | Crosshair axis-label box min-width policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent minimum-width controls with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_min_width_px`, `crosshair_time_label_box_min_width_px`, and `crosshair_price_label_box_min_width_px`. |
| R-060 | Crosshair | Crosshair axis-label box text-alignment policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent text alignment controls with optional shared fallback | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_text_h_align`, `crosshair_time_label_box_text_h_align`, and `crosshair_price_label_box_text_h_align`. |
| R-061 | Crosshair | Crosshair axis-label box vertical-anchor policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent vertical-anchor controls with optional shared fallback | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_vertical_anchor`, `crosshair_time_label_box_vertical_anchor`, and `crosshair_price_label_box_vertical_anchor` using `CrosshairLabelBoxVerticalAnchor::{Top, Center, Bottom}`. |
| R-062 | Crosshair | Crosshair axis-label box horizontal-anchor policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent horizontal-anchor controls with optional shared fallback | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_horizontal_anchor`, `crosshair_time_label_box_horizontal_anchor`, and `crosshair_price_label_box_horizontal_anchor` using `CrosshairLabelBoxHorizontalAnchor::{Left, Center, Right}`. |
| R-063 | Crosshair | Crosshair axis-label box overflow policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent overflow policies (`ClipToAxis`/`AllowOverflow`) with optional shared fallback | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_overflow_policy`, `crosshair_time_label_box_overflow_policy`, and `crosshair_price_label_box_overflow_policy` using `CrosshairLabelBoxOverflowPolicy::{ClipToAxis, AllowOverflow}`. |
| R-064 | Crosshair | Crosshair axis-label box visibility-priority policy per axis | done | Crosshair time and price axis-label boxes support deterministic per-axis visibility-priority resolution when box rectangles overlap | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_visibility_priority`, `crosshair_time_label_box_visibility_priority`, and `crosshair_price_label_box_visibility_priority` using `CrosshairLabelBoxVisibilityPriority::{KeepBoth, PreferTime, PreferPrice}`. |
| R-065 | Crosshair | Crosshair axis-label box clipping-margin policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent clipping margins when overflow policy is `ClipToAxis`, with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_clip_margin_px`, `crosshair_time_label_box_clip_margin_px`, and `crosshair_price_label_box_clip_margin_px`. |
| R-066 | Crosshair | Crosshair axis-label box jitter-stabilization policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent stabilization steps (position quantization in px) with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_stabilization_step_px`, `crosshair_time_label_box_stabilization_step_px`, and `crosshair_price_label_box_stabilization_step_px`. |
| R-067 | Crosshair | Crosshair axis-label box z-order policy per axis | done | Crosshair time and price axis-label boxes support deterministic independent z-order controls with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_box_z_order_policy`, `crosshair_time_label_box_z_order_policy`, and `crosshair_price_label_box_z_order_policy` using `CrosshairLabelBoxZOrderPolicy::{PriceAboveTime, TimeAbovePrice}`. |
| R-068 | Crosshair | Crosshair guide-line stroke-style policy per axis | done | Crosshair horizontal and vertical guide lines support deterministic independent stroke-style controls (`Solid`/`Dashed`/`Dotted`) with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_line_style`, `crosshair_horizontal_line_style`, and `crosshair_vertical_line_style` using `LineStrokeStyle::{Solid, Dashed, Dotted}`. |
| R-069 | Crosshair | Crosshair guide-line color policy per axis | done | Crosshair horizontal and vertical guide lines support deterministic independent color controls with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_horizontal_line_color` and `crosshair_vertical_line_color` (`Option<Color>`) with fallback to shared `crosshair_line_color`. |
| R-070 | Crosshair | Crosshair guide-line width policy per axis | done | Crosshair horizontal and vertical guide lines support deterministic independent width controls with shared fallback compatibility | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_horizontal_line_width` and `crosshair_vertical_line_width` (`Option<f64>`) with fallback to shared `crosshair_line_width`. |
| R-071 | Crosshair | Crosshair guide-line combined visibility gate cleanup | done | Crosshair guide lines support deterministic shared visibility gating combined with per-axis toggles (`shared && axis`) | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added shared render-style knob `show_crosshair_lines` while preserving existing per-axis toggles `show_crosshair_horizontal_line` and `show_crosshair_vertical_line`. |
| R-072 | Crosshair | Crosshair axis-label formatter override per axis | done | Crosshair time and price labels support deterministic independent formatter overrides with fallback to existing axis formatter policies | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added API methods `set/clear_crosshair_time_label_formatter` and `set/clear_crosshair_price_label_formatter`; overrides apply only to crosshair labels and keep axis-label formatting behavior unchanged. |
| R-073 | Crosshair | Crosshair axis-label formatter fallback/cache policy per axis | done | Crosshair formatter overrides use deterministic per-axis cache keys/stats with explicit fallback to existing axis-label formatter/cache behavior when override is absent | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added dedicated cache stats/clear APIs for crosshair formatters (`crosshair_time_label_cache_stats`, `clear_crosshair_time_label_cache`, `crosshair_price_label_cache_stats`, `clear_crosshair_price_label_cache`) and generation-based cache invalidation on formatter updates. |
| R-074 | Crosshair | Crosshair axis-label text transform policy per axis (prefix/suffix) | done | Crosshair time and price labels support deterministic prefix/suffix transforms with shared fallback and independent per-axis overrides | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_prefix`, `crosshair_label_suffix`, `crosshair_time_label_prefix`, `crosshair_time_label_suffix`, `crosshair_price_label_prefix`, and `crosshair_price_label_suffix`; transforms are applied only to crosshair axis labels after formatter/fallback resolution. |
| R-075 | Crosshair | Crosshair axis-label numeric precision policy per axis | done | Crosshair time and price labels support deterministic numeric precision overrides with shared fallback and independent per-axis precision controls | `tests/render_frame_tests.rs`, `tests/render_style_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added render-style knobs `crosshair_label_numeric_precision`, `crosshair_time_label_numeric_precision`, and `crosshair_price_label_numeric_precision`; precision overrides are applied only to crosshair labels while regular axis labels keep existing policies. |
| R-076 | Crosshair | Crosshair axis-label formatter context policy (time span/source mode) | done | Crosshair time and price formatter overrides can receive deterministic context including visible time span and crosshair source mode (snapped vs projected) per axis | `tests/render_frame_tests.rs`, `tests/property_render_frame_tests.rs`, `benches/core_math_bench.rs` | Added context-aware formatter APIs (`set/clear_crosshair_time_label_formatter_with_context`, `set/clear_crosshair_price_label_formatter_with_context`) and public context contracts (`CrosshairTimeLabelFormatterContext`, `CrosshairPriceLabelFormatterContext`, `CrosshairLabelSourceMode`). |
| R-077 | Crosshair | Crosshair axis-label formatter context cache-key policy per axis | done | Context-aware crosshair formatter overrides use deterministic cache keys that partition by formatter generation, source mode, visible span, and axis value quantization | `tests/render_frame_tests.rs`, `benches/core_math_bench.rs` | Extended crosshair formatter cache-profile keys to include context dimensions (`source_mode`, `visible_span`) for both time and price context formatters, preserving per-axis cache stats behavior. |
| R-078 | Crosshair | Crosshair axis-label formatter context invalidation lifecycle | done | Context-aware crosshair formatter caches are invalidated deterministically on context lifecycle transitions (crosshair-mode changes and visible-range changes) | `tests/render_frame_tests.rs` | Added lifecycle invalidation hooks so context-aware crosshair caches clear on `set_crosshair_mode` and `VisibleRangeChanged` flow (`set/pan/zoom/fit/reset` time-range operations). |
| R-079 | Crosshair | Crosshair axis-label formatter context snapshot/export parity | done | Engine snapshots export deterministic crosshair formatter state (override mode per axis + formatter generations) for regression tooling | `tests/api_snapshot_tests.rs`, `tests/property_api_tests.rs` | Added snapshot contract fields `crosshair_formatter.{time_override_mode,price_override_mode,time_formatter_generation,price_formatter_generation}` using `CrosshairFormatterOverrideMode::{None,Legacy,Context}`. |
| R-080 | Crosshair | Crosshair axis-label formatter context API hardening | done | Public API exposes deterministic override-mode and generation introspection per axis, preventing ambiguous host-side formatter lifecycle state | `tests/api_snapshot_tests.rs` | Added APIs `crosshair_time_label_formatter_override_mode`, `crosshair_price_label_formatter_override_mode`, and `crosshair_label_formatter_generations`; snapshot export now reuses these accessors for consistency. |
| R-081 | Crosshair | Crosshair formatter lifecycle property coverage | done | Property tests validate deterministic lifecycle behavior across legacy/context formatter transitions, context invalidation triggers, and snapshot JSON roundtrip parity | `tests/property_api_tests.rs` | Added property scenario covering mixed set/clear operations for legacy/context formatters, crosshair mode/range transitions, deterministic snapshot equality, and roundtrip consistency of exported formatter state. |
| R-082 | Crosshair | GTK/Relm4 integration docs/examples for context formatters | done | Developer docs provide practical, deterministic integration pattern for context-aware crosshair formatters in GTK4/Relm4 host apps | `docs/gtk-relm4-crosshair-formatters.md`, `docs/developer-guide.md` | Added end-to-end integration guide covering engine setup, formatter closures, pointer event wiring, lifecycle invalidation semantics, and host-side diagnostics recommendations. |
| R-083 | Crosshair | Crosshair formatter diagnostics API | done | Public API exposes consolidated diagnostics for crosshair formatter state (override modes, generations, and per-axis cache stats) for host observability/debug tooling | `tests/api_snapshot_tests.rs` | Added `crosshair_formatter_diagnostics` and `clear_crosshair_formatter_caches` API methods with `CrosshairFormatterDiagnostics` contract for deterministic host-side diagnostics. |
| R-084 | Crosshair | Benchmark lifecycle transitions + context cache-hot path | done | Criterion covers deterministic crosshair formatter lifecycle transitions (mode/range) while measuring cache-hot contextual formatter behavior | `benches/core_math_bench.rs` | Added benchmark `bench_crosshair_axis_label_formatter_context_lifecycle_transitions` to exercise repeated pointer/render under crosshair-mode and visible-range transitions. |
| R-085 | Crosshair | Technical API contract matrix for legacy/context per-axis behavior | done | Technical docs include explicit per-axis contract matrix mapping lifecycle actions to override mode, stored formatter slots, generation updates, and shared lifecycle rules | `docs/crosshair-formatter-contract-matrix.md`, `docs/developer-guide.md`, `docs/architecture.md` | Added dedicated matrix document and linked it from developer/architecture docs for host-side integration and debugging consistency. |
| R-086 | Crosshair | Snapshot/diagnostics API coherence hardening tests | done | Tests enforce deterministic coherence between `EngineSnapshot.crosshair_formatter` and `crosshair_formatter_diagnostics()` across mixed lifecycle transitions and cache operations | `tests/api_snapshot_tests.rs`, `tests/property_api_tests.rs` | Added integration and property coverage that assert per-axis override modes/generations stay aligned between snapshot export and diagnostics surface. |
| R-087 | Crosshair | Crosshair formatter diagnostics JSON export contract | done | Diagnostics state has stable JSON export methods for raw and versioned contract payloads | `src/api/json_contract.rs`, `tests/api_snapshot_tests.rs` | Added `crosshair_formatter_diagnostics_json_pretty` and `crosshair_formatter_diagnostics_json_contract_v1_pretty`, plus compatibility parser for raw/contract payloads. |
| R-088 | Crosshair | Snapshot/diagnostics backward-compat schema guard | done | Snapshot and diagnostics payloads support versioned contract wrappers with schema-version guardrails and backward-compatible parsing of legacy raw payloads | `src/api/json_contract.rs`, `tests/api_snapshot_tests.rs`, `tests/property_api_tests.rs` | Added schema constants, contract payload structs, and `from_json_compat_str` parsers for `EngineSnapshot` and `CrosshairFormatterDiagnostics`. |
| R-089 | Crosshair | GTK/Relm4 diagnostics bridge hooks | done | GTK adapter can publish formatter diagnostics and versioned snapshot JSON during draw lifecycle through host hooks without coupling UI code to engine internals | `src/platform_gtk/mod.rs`, `docs/gtk-relm4-crosshair-formatters.md` | Added hook APIs (`set/clear_crosshair_diagnostics_hook`, `set/clear_snapshot_json_hook`) and pull helpers for diagnostics/snapshot contract export. |

## Extensions

| ID | Area | Feature | Status | Acceptance Criteria | Test Evidence | Notes |
|---|---|---|---|---|---|---|
| E-001 | Markers | Advanced marker placement | done | Marker collision and alignment match expected rules | `tests/markers_tests.rs`, `tests/property_markers_tests.rs` | Deterministic marker placement with lane-based collision avoidance and visible-window projection is implemented. |
| E-002 | Plugins | Custom extension hooks | done | Extension points allow bounded custom logic without core coupling | `tests/plugins_tests.rs` | Plugin hooks with deterministic event dispatch and read-only engine context are implemented in the `extensions` layer. |
